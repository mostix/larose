<?phperror_reporting(E_ALL);ini_set('display_errors', 'On');//echo "<pre>";print_r($_POST);//echo "<pre>";print_r($_SERVER);echo "</pre>";//unset($_SESSION['cart']['order_login']);$shopping_cart = array();$has_products_in_cart = false;if (isset($_SESSION['customer']['customer_id'])) {  $customer_id = $_SESSION['customer']['customer_id'];  $customer_is_loged = true;} else {  $customer_is_loged = false;}if (isset($_SESSION['cart'])) {  $shopping_cart = $_SESSION['cart'];  if (count($shopping_cart) > 0)    $has_products_in_cart = true;}$errors = array();print_html_shopping_cart_progress();if (!$has_products_in_cart) {  ?>  <p id="emptyCartWarning" class="alert alert-warning"><?= $languages[$current_lang]['header_shopping_cart_is_empty']; ?></p>  <?php} else {  $url = "/$current_lang/shopping-cart/borica-request";  if ($customer_is_loged) {    //$url = ($customer_id == 4) ? "/$current_lang/shopping-cart/shopping-cart-checkout-cash-success-test" : "/bank-payment/UniversalTester/payment.php";    ?>    <form name="form_customer_order" id="form_customer_order" class="form form_place_order" action="<?= $url; ?>" method="post">      <div class="row">        <div class="col-sp-12 col-xs-12 col-sm-6 col-md-6">          <div class="form" style="padding-left: 0">            <fieldset>              <legend><?= $languages[$current_lang]['header_recipients_data']; ?></legend>              <div>                <label for="shipping_firstname"><?= $languages[$current_lang]['header_firstname']; ?><span class="red">*</span></label>                <input type="text" id="shipping_firstname" class="fa" placeholder="&#xf007;" name="shipping_firstname" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_lastname"><?= $languages[$current_lang]['header_lastname']; ?><span class="red">*</span></label>                <input type="text" id="shipping_lastname" class="fa" placeholder="&#xf007;" name="shipping_lastname" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_phone"><?= $languages[$current_lang]['header_phone']; ?><span class="red">*</span></label>                <input type="text" id="shipping_phone" class="fa" placeholder="&#xf095;" name="shipping_phone" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_address"><?= $languages[$current_lang]['header_site_name']; ?><span class="red">*</span></label>                <input type="text" id="shipping_site" class="fa" placeholder="&#xf0d1;" name="shipping_site" />                <input type="hidden" name="shipping_site_id" id="shipping_site_id" value="" />                <input type="hidden" name="shipping_site_name" id="shipping_site_name" value="" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <p><i class="fa fa-info-circle"></i><i><?= $languages[$current_lang]['text_info_site_name']; ?></i></p>              <p class="red"><?= $languages[$current_lang]['text_info_site_name_delivery']; ?></p>              <div>                <label for="shipping_address"><?= $languages[$current_lang]['header_delivery_address']; ?><span class="red">*</span></label>                <input type="text" id="shipping_address" class="fa" placeholder="&#xf0d1;" name="shipping_address" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>    <?php    $today = date("Y-m-d");    $tomorrow = date("Y-m-d", strtotime('+1 day', strtotime($today)));    $current_hour = date('Hi', time());    //$current_hour = 2001;    if ($current_hour < 1600) {      $shipping_date = $today;      $delivery_price = 0.00;    } else {      $shipping_date = $tomorrow;      $delivery_price = 0.00;    }    ?>              <div>                <label for="shipping_date"><?= $languages[$current_lang]['header_delivery_date']; ?><span class="red">*</span></label>                <input type="text" id="shipping_date" name="shipping_date" readonly class="datepicker fa" placeholder="&#xf073;" value="<?= $shipping_date; ?>" onchange="GetTimeIntervals(this.value)" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <p class="date_info hidden"><i class="fa fa-info-circle"></i><i class="red"><?= $languages[$current_lang]['text_info_delivery_price']; ?></i></p>              <div class="clearfix"></div>              <div id="time_interval">              <?php              print_html_shipping_time_interval_form($shipping_date);              ?>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_card_signature"><?= $languages[$current_lang]['header_card_signature']; ?><span class="red">*</span></label>                <input type="text" id="shipping_card_signature" name="shipping_card_signature" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <p><i class="fa fa-info-circle"></i><i><?= $languages[$current_lang]['text_info_signature']; ?></i></p>              <div class="clearfix"></div>              <div>                <label for="shipping_cardtext"><?= $languages[$current_lang]['header_greeting_text']; ?></label>                <textarea id="shipping_cardtext" name="shipping_cardtext" class="fa" placeholder="&#xf003;"></textarea>              </div>              <div class="clearfix">&nbsp;</div>            </fieldset>          </div>        </div>        <!-- user registration and fields -->        <div class="col-sp-12 col-xs-12 col-sm-6 col-md-6">          <div class="form no_padding">            <fieldset>              <legend><?= $languages[$current_lang]['header_payment_method']; ?></legend>              <div style="margin-bottom: 10px;">    <?php    $query_payment_methods = "SELECT `payment_methods`.`payment_method_id`,`payment_methods`.`payment_method`,`payment_methods`.`payment_method_is_default`,                                         `payment_methods_translations`.`payment_method_translation`                                    FROM `payment_methods`                              INNER JOIN `payment_methods_translations` ON `payment_methods_translations`.`payment_method_id` = `payment_methods`.`payment_method_id`                                   WHERE `payment_methods_translations`.`language_id` = '$current_language_id'";    //echo $query_payment_methods."<br>";    $result_payment_methods = mysqli_query($db_link, $query_payment_methods);    if (!$result_payment_methods)      echo mysqli_error($db_link);    $count_payment_methods = mysqli_num_rows($result_payment_methods);    if ($count_payment_methods > 0) {      while ($row_payment_methods = mysqli_fetch_assoc($result_payment_methods)) {        $payment_method_id = $row_payment_methods['payment_method_id'];        $payment_method = $row_payment_methods['payment_method'];        $payment_method_is_default = $row_payment_methods['payment_method_is_default'];        $payment_method_translation = stripslashes($row_payment_methods['payment_method_translation']);        $checked = ($payment_method_is_default == 1) ? "checked='checked'" : "";        ?>                    <input type='radio' name='payment_method' id="payment_method_<?= $payment_method_id ?>" class='payment_method' value='<?= $payment_method ?>' <?= $checked ?>>                    <label for="payment_method_<?= $payment_method_id ?>" style="display: inline-block"><?= $payment_method_translation ?></label> &nbsp;                    <input type='hidden' name='payment[<?= $payment_method ?>][0]' value='<?= $payment_method_id ?>'>                    <input type='hidden' name='payment[<?= $payment_method ?>][1]' value='<?= $payment_method_translation ?>'>                    <?php                  }                }                ?>              </div>              <div id="paypal" class="payment_method_img">                <p>                <table border="0" cellpadding="10" cellspacing="0" align="center"><tr><td align="center"></td></tr><tr><td align="center"><a href="https://www.paypal.com/webapps/mpp/paypal-popup" title="How PayPal Works" onclick="javascript:window.open('https://www.paypal.com/webapps/mpp/paypal-popup', 'WIPaypal', 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=1060, height=700'); return false;"><img src="https://www.paypalobjects.com/webstatic/mktg/logo/AM_mc_vs_dc_ae.jpg" border="0" alt="PayPal Acceptance Mark"></a></td></tr></table>                </p>              </div>              <div id="delivery" class="payment_method_img">                <p>                  <i class="fa fa-truck fa-5x"></i>                  <img src="/frontstore/images/cash-on-delivery.jpg" alt="Cash on delivery" width="60" height="60">                </p>                <p><?= $languages[$current_lang]['text_cash_on_delivery']; ?></p>              </div>              <div id="card" class="payment_method_img">                <div class="single_card">                  <img src="/frontstore/images/visa_79x50.png" alt="Visa card logo" width="79" height="50">                </div>                <div class="single_card">                  <img src="/frontstore/images/visa_electron_79x50.png" alt="Visa Electron card logo" width="79" height="50">                </div>                <div class="single_card">                  <img src="/frontstore/images/v_pay_46x50.png" alt="V-pay card logo" width="46" height="50">                </div>                <div class="single_card">                  <a href="https://www.mastercard.com/index.html" target="_blank">                    <img src="/frontstore/images/mc_accpt_80x50.gif" alt="MasterCard logo" width="80" height="50">                  </a>                </div>                <div class="single_card">                  <a href="https://www.mastercard.com/index.html" target="_blank">                    <img src="/frontstore/images/me_accpt_80x50.gif" alt="MasterCard Electron logo" width="80" height="50">                  </a>                </div>                <div class="single_card more_margin">                  <a href="https://www.maestrocard.com/gateway/index.html" target="_blank">                    <img src="/frontstore/images/ms_accpt_80x50.gif" alt="Maestro card logo" width="80" height="50">                  </a>                </div>                <div class="single_card more_margin">                  <img src="/frontstore/images/vbv_98x50.gif" alt="Verified by Visa logo" width="98" height="50">                </div>                <div class="single_card">                  <img src="/frontstore/images/sclogo_92x50.gif" alt="MasterCard SecureCode logo" width="92" height="50">                </div>                <div class="clearfix"></div>                <h3 class="red"><?= $languages[$current_lang]['text_card_payment_important']; ?></h3>                <p><?= $languages[$current_lang]['text_card_payment']; ?></p>              </div>              <div id="epay" class="payment_method_img">                <img src="/frontstore/images/easypay-logo.gif" alt="Easypay logo" width="240" height="68">                <p><?= $languages[$current_lang]['text_easypay']; ?></p>              </div>            </fieldset>          </div>        </div>        <div class="form no_padding">          <fieldset>            <legend><?= $languages[$current_lang]['header_additional_orders_note']; ?></legend>            <textarea name="order_comment" id="order_comment"></textarea>          </fieldset>        </div>        <p class="clearfix">&nbsp;</p>        <table id="cart_summary" class="table table-bordered stock-management-on">          <thead>            <tr>              <th class="item" width="10%"><?= $languages[$current_lang]['header_product']; ?></th>              <th class="item" width="40%"></th>              <th class="item" width="15%"><?= $languages[$current_lang]['header_isbn']; ?></th>              <th class="item" width="15%" class="text-center"><?= $languages[$current_lang]['header_quantity']; ?></th>              <th class="item" width="10%"><?= $languages[$current_lang]['header_unit_price']; ?></th>              <th class="item" width="10%"><?= $languages[$current_lang]['header_total_price']; ?></th>            </tr>          </thead>          <tbody>    <?php    $total_order_price = 0;    $key = 0;    $descr = "";    foreach ($shopping_cart as $products) {      $product_id = $products['product_id'];      $product_isbn = $products['product_isbn'];      $product_price = $products['product_price'];      $product_name = $products['product_name'];      $descr .= ($key == 0) ? $product_name : ", $product_name";      $product_url = $products['product_url'];      $product_img_src = $products['product_img_src'];      $product_image_params = @getimagesize($_SERVER['DOCUMENT_ROOT'] . $product_img_src);      $product_image_dimensions = $product_image_params[3];      $product_qty = $products['product_qty'];      $product_price_total = number_format(($product_price * $product_qty), 2, ".", "");      $total_order_price = $total_order_price + ($product_price * $product_qty);      ?>              <tr id="product_<?= $product_id; ?>">                <td class="cart_product">                  <a href="<?= $product_url; ?>" target="_blank">                    <img src="<?= $product_img_src ?>" class="img_table" <?= $product_image_dimensions ?>>                  </a>                </td>                <td class="cart_description"><?= $product_name ?></td>                <td class="cart_quantity text-center"><?= $product_price ?><span class="currency">&nbsp;лв.</span></td>                <td>                  <div class="product_qty text-center"><?= $product_qty ?></div>                </td>                <td class="cart_unit text-center">                  <ul class="price" id="product_price_6_31_0">                    <li class="price product_price"><?= $product_price ?><span class="currency">&nbsp;лв.</span></li>                  </ul>                </td>                <td class="cart_total text-center price">                  <span class="product_price_total"><?= $product_price_total ?></span><span class="currency">&nbsp;лв.</span>                </td>              </tr>      <?php      $key++;    }    $total_order_price_fomatted = number_format($total_order_price, 2, ".", "");    //echo $delivery_price;    $delivery_price = 0.00;    $total_order_price_with_delivery = number_format($total_order_price + $delivery_price, 2, ".", "");    ?>          </tbody>          <tfoot>            <tr class="cart_total_delivery">              <td colspan="2"></td>              <td colspan="3" class="text-right"><?= $languages[$current_lang]['header_delivery']; ?></td>              <td class="price" id="total_shipping">                <span class="price"><?= number_format($delivery_price, 2, ".", "") ?></span><span class="currency">&nbsp;лв.</span>                <input type="hidden" id="product_descriptions" name="product_descriptions" value="<?= $descr ?>" />                <input type="hidden" id="delivery_price" name="delivery_price" value="<?= number_format($delivery_price, 2, ".", "") ?>" />              </td>            </tr>            <tr class="cart_total_price">              <td colspan="2"></td>              <td colspan="3" class="text-right"><?= $languages[$current_lang]['header_total_products_price']; ?></td>              <td class="price">                <span><?= $total_order_price_fomatted ?></span><span class="currency">&nbsp;лв.</span></span>                <input type="hidden" id="order_total" name="order_total" value="<?= $total_order_price_fomatted ?>">              </td>            </tr>            <tr class="cart_total_price">              <td colspan="2"></td>              <td colspan="3" class="text-right">                <span><?= $languages[$current_lang]['header_total_price_with_delivery']; ?></span>              </td>              <td class="price" id="total_price_container">                <span id="total_order_price"><?= $total_order_price_with_delivery ?></span><span class="currency">&nbsp;лв.</span></span>              </td>            </tr>          </tfoot>        </table>        <div class="accept_terms_box">          <input type="checkbox" name="accept_terms" id="accept_terms" />           <label for="accept_terms" style="display: inline-block"><?= $languages[$current_lang]['header_accept_terms_and_conditions_01']; ?></label>          <a href="/<?= $current_lang; ?>/<?php if ($current_lang == "bg") echo "общи-условия";        else echo "terms-and-conditions"; ?>#terms_cond" style="text-decoration: underline;" target="_blank">    <?= $languages[$current_lang]['header_accept_terms_and_conditions_02']; ?>          </a>        </div>        <p class="clearfix">&nbsp;</p>        <p class="cart_navigation clearfix">          <a href="/<?= $current_lang; ?>/shopping-cart/shopping-cart-overview" class="btn btn-outline">    <?= $languages[$current_lang]['btn_back']; ?>          </a>    <?php    if ($customer_is_loged) {      ?>            <button type="submit" name="customer_order" class="btn btn-outline pull-right place_order">      <?= $languages[$current_lang]['btn_order']; ?>            </button>               <?php            }            ?>        </p>      </div>    </form>    <?php  } //if($customer_is_loged)  else {    //guest    ?>    <div class="row" style="text-align: center;">      <div class="col-sp-12 col-xs-12 col-sm-4 col-md-4">        <div class="option_box">          <h3><?= $languages[$current_lang]['header_registered_cumstomer']; ?></h3>          <p><?= $languages[$current_lang]['text_registered_cumstomer']; ?></p>          <a href="javascript:;" class="login_btn button btn btn-outline"><?= $languages[$current_lang]['btn_login']; ?></a>        </div>      </div>      <div class="col-sp-12 col-xs-12 col-sm-4 col-md-4">        <div class="option_box">          <h3><?= $languages[$current_lang]['header_new_cumstomer']; ?></h3>          <p><?= $languages[$current_lang]['text_new_cumstomer']; ?></p>          <a href="/<?= $current_lang; ?>/shopping-cart/shopping-cart-registration" class="button btn btn-outline">    <?= $languages[$current_lang]['btn_sign_up']; ?>          </a>        </div>      </div>      <div class="col-sp-12 col-xs-12 col-sm-4 col-md-4">        <div class="option_box">          <h3><?= $languages[$current_lang]['header_quik_order']; ?></h3>          <p><?= $languages[$current_lang]['text_quik_order']; ?></p>          <a href="javascript:;" class="button btn btn-outline quik_order">    <?= $languages[$current_lang]['btn_order']; ?>          </a>        </div>      </div>    </div>    <p class="clearfix">&nbsp;</p>    <form name="form_quick_order" id="form_quick_order" class="form form_place_order" action="<?= $url; ?>" method="post">      <p>&nbsp;</p>      <div class="row">        <div class="col-sp-12 col-xs-12 col-sm-6 col-md-6">          <div class="form" style="padding-left: 0">            <fieldset>              <legend><?= $languages[$current_lang]['header_recipients_data']; ?></legend>              <div>                <label for="shipping_firstname"><?= $languages[$current_lang]['header_firstname']; ?><span class="red">*</span></label>                <input type="text" id="shipping_firstname" class="fa" placeholder="&#xf007;" name="shipping_firstname" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_lastname"><?= $languages[$current_lang]['header_lastname']; ?><span class="red">*</span></label>                <input type="text" id="shipping_lastname" class="fa" placeholder="&#xf007;" name="shipping_lastname" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_phone"><?= $languages[$current_lang]['header_phone']; ?><span class="red">*</span></label>                <input type="text" id="shipping_phone" class="fa" placeholder="&#xf095;" name="shipping_phone" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_address"><?= $languages[$current_lang]['header_site_name']; ?><span class="red">*</span></label>                <input type="text" id="shipping_site" class="fa" placeholder="&#xf0d1;" name="shipping_site" />                <input type="hidden" name="shipping_site_id" id="shipping_site_id" value="" />                <input type="hidden" name="shipping_site_name" id="shipping_site_name" value="" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <p><i class="fa fa-info-circle"></i><i><?= $languages[$current_lang]['text_info_site_name']; ?></i></p>              <p class="red"><?= $languages[$current_lang]['text_info_site_name_delivery']; ?></p>              <div>                <label for="shipping_address"><?= $languages[$current_lang]['header_delivery_address']; ?><span class="red">*</span></label>                <input type="text" id="shipping_address" class="fa" placeholder="&#xf0d1;" name="shipping_address" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <!--<p><i class="fa fa-info-circle"></i><i>Само за гр. София</i></p>-->              <div class="clearfix"></div>    <?php    $today = date("Y-m-d");    $tomorrow = date("Y-m-d", strtotime('+1 day', strtotime($today)));    $current_hour = date('Hi', time());    if ($current_hour < 1600) {      $shipping_date = $today;      $delivery_price = 0.00;    } else {      $shipping_date = $tomorrow;      $delivery_price = 0.00;    }    ?>              <div>                <label for="shipping_date"><?= $languages[$current_lang]['header_delivery_date']; ?><span class="red">*</span></label>                <input type="text" id="shipping_date" name="shipping_date" readonly class="datepicker fa" placeholder="&#xf073;" value="<?= $shipping_date; ?>" onchange="GetTimeIntervals(this.value)" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <p class="date_info hidden"><i class="fa fa-info-circle"></i><i class="red"><?= $languages[$current_lang]['text_info_delivery_price']; ?></i></p>              <div class="clearfix"></div>              <div id="time_interval">              <?php              print_html_shipping_time_interval_form($shipping_date);              ?>              </div>              <div class="clearfix"></div>              <div>                <label for="shipping_card_signature"><?= $languages[$current_lang]['header_card_signature']; ?><span class="red">*</span></label>                <input type="text" id="shipping_card_signature" name="shipping_card_signature" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <p><i class="fa fa-info-circle"></i><i><?= $languages[$current_lang]['text_info_signature']; ?></i></p>              <div class="clearfix"></div>              <div>                <label for="shipping_cardtext"><?= $languages[$current_lang]['header_greeting_text']; ?></label>                <textarea id="shipping_cardtext" name="shipping_cardtext" class="fa" placeholder="&#xf003;"></textarea>              </div>              <div class="clearfix">&nbsp;</div>            </fieldset>          </div>        </div>        <!-- user registration and fields -->        <div class="col-sp-12 col-xs-12 col-sm-6 col-md-6">          <div class="form no_padding">            <fieldset>              <legend><?= $languages[$current_lang]['header_senders_data']; ?></legend>              <div>                <label for="customer_address_firstname"><?= $languages[$current_lang]['header_customer_firstname']; ?><span class="red">*</span></label>                <input type="text" name="customer_address_firstname" class="customer_address_firstname fa" placeholder="&#xf007;" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="customer_address_lastname"><?= $languages[$current_lang]['header_customer_lastname']; ?><span class="red">*</span></label>                <input type="text" name="customer_address_lastname" class="customer_address_lastname fa" placeholder="&#xf007;" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="customer_address_phone"><?= $languages[$current_lang]['header_customer_address_phone']; ?><span class="red">*</span></label>                <input type="text" name="customer_address_phone" class="customer_address_phone fa" placeholder="&#xf095;" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>              <div>                <label for="customer_address_email">Email<span class="red">*</span></label>                <input type="text" name="customer_address_email" class="customer_address_email fa" placeholder="&#xf0e0;" required="required" />                <div class="alert alert-danger" style="display: none"><?= $languages[$current_lang]['required_field_error']; ?>!</div>              </div>              <div class="clearfix"></div>            </fieldset>          </div>          <div class="form no_padding">            <fieldset>              <legend><?= $languages[$current_lang]['header_additional_orders_note']; ?></legend>              <textarea name="order_comment" id="order_comment"></textarea>            </fieldset>          </div>          <div class="form no_padding">            <fieldset>              <legend><?= $languages[$current_lang]['header_payment_method']; ?></legend>              <div style="margin-bottom: 10px;">    <?php    $query_payment_methods = "SELECT `payment_methods`.`payment_method_id`,`payment_methods`.`payment_method`,`payment_methods`.`payment_method_is_default`,                                        `payment_methods_translations`.`payment_method_translation`                                  FROM `payment_methods`                                  INNER JOIN `payment_methods_translations` ON `payment_methods_translations`.`payment_method_id` = `payment_methods`.`payment_method_id`                                  WHERE `payment_methods`.`payment_method_is_active` = '1'                                    AND `payment_methods_translations`.`language_id` = '$current_language_id'";    //echo $query_payment_methods."<br>";    $result_payment_methods = mysqli_query($db_link, $query_payment_methods);    if (!$result_payment_methods)      echo mysqli_error($db_link);    $count_payment_methods = mysqli_num_rows($result_payment_methods);    if ($count_payment_methods > 0) {      while ($row_payment_methods = mysqli_fetch_assoc($result_payment_methods)) {        $payment_method_id = $row_payment_methods['payment_method_id'];        $payment_method = $row_payment_methods['payment_method'];        $payment_method_is_default = $row_payment_methods['payment_method_is_default'];        $payment_method_translation = stripslashes($row_payment_methods['payment_method_translation']);        $checked = ($payment_method_is_default == 1) ? "checked='checked'" : "";        ?>                    <input type='radio' name='payment_method' id="payment_method_<?= $payment_method_id ?>" class='payment_method' value='<?= $payment_method ?>' <?= $checked ?>>                    <label for="payment_method_<?= $payment_method_id ?>" style="display: inline-block"><?= $payment_method_translation ?></label> &nbsp;                    <input type='hidden' name='payment[<?= $payment_method ?>][0]' value='<?= $payment_method_id ?>'>                    <input type='hidden' name='payment[<?= $payment_method ?>][1]' value='<?= $payment_method_translation ?>'>                    <?php                  }                }                ?>              </div>              <div id="delivery" class="payment_method_img">                <p>                  <i class="fa fa-truck fa-5x"></i>                  <img src="/frontstore/images/cash-on-delivery.jpg" alt="Cash on delivery" width="60" height="60">                </p>                <p><?= $languages[$current_lang]['text_cash_on_delivery']; ?></p>              </div>              <div id="card" class="payment_method_img">                <div class="single_card">                  <img src="/frontstore/images/visa_79x50.png" alt="Visa card logo" width="79" height="50">                </div>                <div class="single_card">                  <img src="/frontstore/images/visa_electron_79x50.png" alt="Visa Electron card logo" width="79" height="50">                </div>                <div class="single_card">                  <img src="/frontstore/images/v_pay_46x50.png" alt="V-pay card logo" width="46" height="50">                </div>                <div class="single_card">                  <a href="https://www.mastercard.com/index.html" target="_blank">                    <img src="/frontstore/images/mc_accpt_80x50.gif" alt="MasterCard logo" width="80" height="50">                  </a>                </div>                <div class="single_card">                  <a href="https://www.mastercard.com/index.html" target="_blank">                    <img src="/frontstore/images/me_accpt_80x50.gif" alt="MasterCard Electron logo" width="80" height="50">                  </a>                </div>                <div class="single_card more_margin">                  <a href="https://www.maestrocard.com/gateway/index.html" target="_blank">                    <img src="/frontstore/images/ms_accpt_80x50.gif" alt="Maestro card logo" width="80" height="50">                  </a>                </div>                <div class="single_card more_margin">                  <img src="/frontstore/images/vbv_98x50.gif" alt="Verified by Visa logo" width="98" height="50">                </div>                <div class="single_card">                  <img src="/frontstore/images/sclogo_92x50.gif" alt="MasterCard SecureCode logo" width="92" height="50">                </div>                <div class="clearfix"></div>                <h3 class="red"><?= $languages[$current_lang]['text_card_payment_important']; ?></h3>                <p><?= $languages[$current_lang]['text_card_payment']; ?></p>              </div>              <div id="epay" class="payment_method_img">                <img src="/frontstore/images/easypay-logo.gif" alt="Easypay logo" width="240" height="68">                <p><?= $languages[$current_lang]['text_easypay']; ?></p>              </div>            </fieldset>          </div>        </div>        <p class="clearfix">&nbsp;</p>        <table id="cart_summary" class="table table-bordered stock-management-on">          <thead>            <tr>              <th class="item" width="10%"><?= $languages[$current_lang]['header_product']; ?></th>              <th class="item" width="40%"></th>              <th class="item" width="15%"><?= $languages[$current_lang]['header_isbn']; ?></th>              <th class="item" width="15%" class="text-center"><?= $languages[$current_lang]['header_quantity']; ?></th>              <th class="item" width="10%"><?= $languages[$current_lang]['header_unit_price']; ?></th>              <th class="item" width="10%"><?= $languages[$current_lang]['header_total_price']; ?></th>            </tr>          </thead>          <tbody>    <?php    $total_order_price = 0;    $key = 0;    $descr = "";    foreach ($shopping_cart as $products) {      $product_id = $products['product_id'];      $product_isbn = $products['product_isbn'];      $product_price = $products['product_price'];      $product_name = $products['product_name'];      $descr .= ($key == 0) ? $product_name : ", $product_name";      $product_url = $products['product_url'];      $product_img_src = $products['product_img_src'];      $product_image_params = getimagesize($_SERVER['DOCUMENT_ROOT'] . $product_img_src);      $product_image_dimensions = $product_image_params[3];      $product_qty = $products['product_qty'];      $product_price_total = number_format(($product_price * $product_qty), 2, ".", "");      $total_order_price = $total_order_price + ($product_price * $product_qty);      ?>              <tr id="product_<?= $product_id; ?>">                <td class="cart_product">                  <a href="<?= $product_url; ?>" target="_blank">                    <img src="<?= $product_img_src ?>" class="img_table" <?= $product_image_dimensions ?>>                  </a>                </td>                <td class="cart_description"><?= $product_name ?></td>                <td class="cart_quantity text-center"><?= $product_price ?><span class="currency">&nbsp;лв.</span></td>                <td>                  <div class="product_qty text-center"><?= $product_qty ?></div>                </td>                <td class="cart_unit text-center">                  <ul class="price" id="product_price_6_31_0">                    <li class="price product_price"><?= $product_price ?><span class="currency">&nbsp;лв.</span></li>                  </ul>                </td>                <td class="cart_total text-center price">                  <span class="product_price_total"><?= $product_price_total ?></span><span class="currency">&nbsp;лв.</span>                </td>              </tr>              <?php              $key++;            }            $total_order_price_fomatted = number_format($total_order_price, 2, ".", "");            $delivery_price = 0.00;            $total_order_price_with_delivery = number_format($total_order_price + $delivery_price, 2, ".", "");            ?>          </tbody>          <tfoot>            <tr class="cart_total_delivery">              <td colspan="2"></td>              <td colspan="3" class="text-right"><?= $languages[$current_lang]['header_delivery']; ?></td>              <td class="price" id="total_shipping">                <span class="price"><?= number_format($delivery_price, 2, ".", "") ?></span><span class="currency">&nbsp;лв.</span>                <input type="hidden" id="delivery_price" name="delivery_price" value="<?= number_format($delivery_price, 2, ".", "") ?>" />              </td>            </tr>            <tr class="cart_total_price">              <td colspan="2"></td>              <td colspan="3" class="text-right"><?= $languages[$current_lang]['header_total_products_price']; ?></td>              <td class="price">                <span><?= $total_order_price_fomatted ?></span><span class="currency">&nbsp;лв.</span></span>                <input type="hidden" id="order_total" name="order_total" value="<?= $total_order_price_fomatted ?>">              </td>            </tr>            <tr class="cart_total_price">              <td colspan="2"></td>              <td colspan="3" class="text-right">                <span><?= $languages[$current_lang]['header_total_price_with_delivery']; ?></span>              </td>              <td class="price" id="total_price_container">                <span id="total_order_price"><?= $total_order_price_with_delivery ?></span><span class="currency">&nbsp;лв.</span></span>              </td>            </tr>          </tfoot>        </table>        <div class="accept_terms_box">          <input type="checkbox" name="accept_terms" id="accept_terms" />           <label for="accept_terms" style="display: inline-block"><?= $languages[$current_lang]['header_accept_terms_and_conditions_01']; ?></label>          <a href="/<?= $current_lang; ?>/<?php if ($current_lang == "bg") echo "общи-условия";        else echo "terms-and-conditions"; ?>#terms_cond" style="text-decoration: underline;" target="_blank">    <?= $languages[$current_lang]['header_accept_terms_and_conditions_02']; ?>          </a>        </div>        <p class="cart_navigation clearfix">          <button type="submit" name="quick_order" class="button btn btn-outline standard-checkout button-medium pull-right btn-sm place_order">    <?= $languages[$current_lang]['btn_order']; ?>          </button        </p>      </div>      <!--<div class="row">-->    </form>    <?php  } //guest  ?>  <!--modal_confirm-->  <div style="display:none;" id="modal_confirm_terms" class="clearfix" title="<?= $languages[$current_lang]['text_warning']; ?>">    <p style="padding:0;margin:0;width:100%;float:left;line-height: 1.3em;"><?= $languages[$current_lang]['warning_accept_terms_first']; ?></p>  </div>  <div style="display:none;" id="modal_first_choose_site" class="clearfix" title="<?= $languages[$current_lang]['text_warning']; ?>">    <p style="padding:0;margin:0;width:100%;float:left;line-height: 1.3em;"><?= $languages[$current_lang]['warning_first_choose_site']; ?></p>  </div>  <div style="display:none;" id="modal_confirm_time_interval" class="clearfix" title="<?= $languages[$current_lang]['text_warning']; ?>">    <p style="padding:0;margin:0;width:100%;float:left;line-height: 1.3em;"><?= $languages[$current_lang]['warning_no_time_interval_selected']; ?></p>  </div>  <div style="display:none;" id="modal_shipping_time_interval_not_available" class="clearfix" title="<?= $languages[$current_lang]['text_warning']; ?>">    <p style="padding:0;margin:0;width:100%;float:left;line-height: 1.3em;"><?= $languages[$current_lang]['warning_shipping_time_interval_not_available']; ?></p>  </div>  <script type="text/javascript">    $(document).ready(function () {      var today = new Date();      var hours = parseInt(today.getUTCHours()) + 2;      var minutes = ('0' + today.getMinutes()).slice(-2);      var current_hour = hours + "" + minutes;      var tomorrow = new Date();      tomorrow.setDate(tomorrow.getDate() + 1);      start_date = (<?= $current_hour; ?> > 1600) ? tomorrow : today;      //console.log(<?= $current_hour; ?>);      $(".datepicker").datepicker({dateFormat: "yy-mm-dd", minDate: start_date});      $(".quik_order").bind('click', function () {        var quik_order_view = $("#form_quick_order").css("display");        //alert(quik_order_view);        if (quik_order_view == "block") {          $("#form_quick_order").hide();        } else {          $("#form_quick_order").show();        }      });      //autocomplete sites      $("#shipping_site").autocomplete({        source: "/frontstore/ajax/get-sites-autocomplete.php",        minLength: 2,        select: function (event, ui) {          //alert(ui.item.site_name);          $('#shipping_site_id').val(ui.item.site_id);          $('#shipping_site_name').val(ui.item.site_type + " " + ui.item.site_name);        },        close: function (event, ui) {          $('#shipping_site').val($('#shipping_site_name').val());          //GetTimeIntervals($("#shipping_date").val());        }      });      $("#time_interval .time_interval").bind('click', function () {        var link = $(this);        if (link.hasClass("hint_not_aval")) {          $("#modal_shipping_time_interval_not_available").dialog("open");          return;        }        $(".time_interval input").attr("disabled", true);        $(".time_interval").removeClass("active");        link.addClass("active");        link.children("input").attr("disabled", false);      });      $("#has_invoice_address").bind('click', function () {        var checkbox_1 = document.getElementById("has_invoice_address");        var checkbox_state_1 = checkbox_1.checked;        //alert(checkbox_state_1);        if (checkbox_state_1) {          checkbox_1.checked = true;          $("#has_invoice_address_box").show();        } else {          checkbox_1.checked = false;          $("#has_invoice_address_box").hide();        }      });      $("#input_invoice_address").bind('click', function () {        var checkbox = document.getElementById("input_invoice_address");        var checkbox_state = checkbox.checked;        if (checkbox_state) {          checkbox.checked = true;          $("#customer_invoice_addresses").hide();        } else {          checkbox.checked = false;          $("#customer_invoice_addresses").show();        }      });      $("#modal_first_choose_site").dialog({        resizable: false,        width: 400,        height: 200,        autoOpen: false,        modal: true,        draggable: false,        closeOnEscape: true,        dialogClass: "modal_confirm",        buttons: {          "<?= $languages[$current_lang]['btn_close']; ?>": function () {            $(this).dialog("close");          }        }      });      $("#modal_shipping_time_interval_not_available").dialog({        resizable: false,        width: 400,        height: 200,        autoOpen: false,        modal: true,        draggable: false,        closeOnEscape: true,        dialogClass: "modal_confirm",        buttons: {          "<?= $languages[$current_lang]['btn_close']; ?>": function () {            $(this).dialog("close");          }        }      });      $("#modal_confirm_time_interval").dialog({        resizable: false,        width: 400,        height: 200,        autoOpen: false,        modal: true,        draggable: false,        closeOnEscape: true,        dialogClass: "modal_confirm",        buttons: {          "<?= $languages[$current_lang]['btn_close']; ?>": function () {            $(this).dialog("close");          }        }      });      $("#modal_confirm_terms").dialog({        resizable: false,        width: 400,        height: 200,        autoOpen: false,        modal: true,        draggable: false,        closeOnEscape: true,        dialogClass: "modal_confirm",        buttons: {          "<?= $languages[$current_lang]['btn_close']; ?>": function () {            $(".accept_terms_box").css({color: "red"});            $(".accept_terms_box a").css({color: "red"});            $(this).dialog("close");            setTimeout(function () {              $(".accept_terms_box").css({color: "#5a5a5a"});              $(".accept_terms_box a").css({color: "#3881C2"});            }, 4000);          }        }      });      $(".place_order").click(function (event) {        var required_fields_ok = true;        $(".form input[required='required']").each(function () {          if ($(this).val() == "") {            $(this).next(".alert").show();            required_fields_ok = false;          } else {            $(this).next(".alert").hide();          }        });        if (!required_fields_ok) {          $('body,html').animate({scrollTop: 230}, 600);          event.preventDefault();          return;        }        if (!$(".time_interval.active").length) {          $("#modal_confirm_time_interval").dialog("open");          event.preventDefault();          return;        } else {          var state_sterms = ($("#accept_terms").is(':checked') ? "1" : "0");          if (state_sterms == "0") {            $("#modal_confirm_terms").dialog("open");            event.preventDefault();            return;          }        }      });      $.each($(".payment_method"), function () {        if ($(this).is(":checked")) {          $("#" + $(this).val()).show();        }      })      //$(".payment_method_img:first").show();      $(".payment_method").click(function () {        var payment_method = $(this).val();        $(".payment_method_img").hide();        $("#" + payment_method).show();        if (payment_method == "paypal") {          $(".form_place_order").attr("action", "/<?= $current_lang; ?>/shopping-cart/borica_request");        } else if (payment_method == "delivery") {          $(".form_place_order").attr("action", "/<?= $current_lang; ?>/shopping-cart/borica_request");        } else if (payment_method == "epay") {          $(".form_place_order").attr("action", "/<?= $current_lang; ?>/shopping-cart/borica_request");        } else {          $(".form_place_order").attr("action", "/<?= $current_lang; ?>/shopping-cart/borica_request");        }      });    });  </script>  <?php} //if($has_products_in_cart)